<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Folk Tale with a Twist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:ital,wght@0,300;0,400;0,700;1,400&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'mystic-dark': '#1a1025',
                        'mystic-purple': '#2d1b4e',
                        'royal-gold': '#d4af37',
                        'parchment': '#fdfbf7',
                        'ink': '#2c3e50',
                        'forest': '#2d4e3e'
                    },
                    fontFamily: {
                        'fantasy': ['Cinzel', 'serif'],
                        'body': ['Lato', 'sans-serif'],
                        'narrative': ['Playfair Display', 'serif']
                    },
                    boxShadow: {
                        'glow': '0 0 15px rgba(212, 175, 55, 0.3)',
                        'paper': '5px 5px 15px rgba(0,0,0,0.2)'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #1a1025;
            background-image: radial-gradient(circle at 50% 50%, #2d1b4e 0%, #1a1025 100%);
        }
        .parchment-texture {
            background-color: #fdfbf7;
            background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23d4af37' fill-opacity='0.05' fill-rule='evenodd'%3E%3Cpath d='M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41zM20 18.6l2.83-2.83 1.41 1.41L21.41 20l2.83 2.83-1.41 1.41L20 21.41l-2.83 2.83-1.41-1.41L18.59 20l-2.83-2.83 1.41-1.41L20 18.59z'/%3E%3C/g%3E%3C/svg%3E");
        }
        .decorative-border {
            border: 2px solid #d4af37;
            position: relative;
        }
        .decorative-border::after {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            right: 4px;
            bottom: 4px;
            border: 1px solid #d4af37;
            pointer-events: none;
        }
        /* Quiz Modal Styles */
        .modal-enter { opacity: 0; transform: scale(0.9); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 300ms, transform 300ms; }
        .modal-exit { opacity: 1; transform: scale(1); }
        .modal-exit-active { opacity: 0; transform: scale(0.9); transition: opacity 300ms, transform 300ms; }
        
        .selected-correct { border-color: #10b981 !important; background-color: #ecfdf5 !important; }
        .selected-wrong { border-color: #ef4444 !important; background-color: #fef2f2 !important; }

        /* Hide print button when printing */
        @media print {
            .print\:hidden { display: none; }
            body { background: white; }
            .max-w-5xl { box-shadow: none; max-width: 100%; width: 100%; }
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 flex items-center justify-center font-body text-gray-800">

    <!-- Main Container -->
    <div class="max-w-5xl w-full parchment-texture rounded-xl shadow-2xl overflow-hidden relative">
        
        <!-- Header Section -->
        <header class="bg-mystic-purple text-parchment p-8 text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
                <i class="fas fa-feather-alt text-9xl absolute -left-10 -top-10 transform rotate-45"></i>
                <i class="fas fa-book-open text-9xl absolute -right-10 -bottom-10"></i>
            </div>
            
            <div class="relative z-10">
                <span class="text-royal-gold tracking-[0.3em] text-sm uppercase font-bold mb-2 block">Creative Writing Challenge</span>
                <h1 class="text-4xl md:text-6xl font-fantasy text-white mb-2" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">A Folk Tale with a Twist</h1>
                <p class="text-lg md:text-xl font-narrative italic text-royal-gold">"There are two sides to every story..."</p>
            </div>
        </header>

        <!-- Content Grid -->
        <div class="p-6 md:p-10 grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Left Column: The Concept & Instructions (7 cols) -->
            <div class="lg:col-span-7 space-y-8">
                
                <!-- The Objective -->
                <section>
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 rounded-full bg-mystic-purple text-royal-gold flex items-center justify-center text-xl shrink-0">
                            <i class="fas fa-bullseye"></i>
                        </div>
                        <h2 class="text-2xl font-fantasy text-mystic-purple border-b-2 border-royal-gold pb-1 w-full">The Mission (TOK Connection)</h2>
                    </div>
                    <p class="text-ink text-lg leading-relaxed">
                        History is written by the victors. Choose a famous folk tale and retell it from the Villain's perspective. 
                        <strong>Crucially, you must apply the psychology of <span class="text-purple-700 font-bold">Moral Disengagement</span> to justify their actions.</strong>
                    </p>
                </section>

                <!-- TOK Focus: Moral Disengagement -->
                <section class="bg-indigo-50 p-6 rounded-lg border border-indigo-200 shadow-sm relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10 pointer-events-none">
                        <i class="fas fa-brain text-6xl text-mystic-purple"></i>
                    </div>
                    <h3 class="font-fantasy text-xl text-mystic-purple mb-3 border-b border-indigo-200 pb-2">
                        <i class="fas fa-balance-scale mr-2"></i>TOK Focus: Moral Disengagement
                    </h3>
                    <p class="text-ink text-sm mb-4">
                        How do good people do bad things? They convince themselves it's acceptable. Use one of these mechanisms in your story:
                    </p>
                    
                    <div class="space-y-3">
                        <!-- Mechanism 1 -->
                        <div class="bg-white p-3 rounded border-l-4 border-royal-gold shadow-sm">
                            <h4 class="font-bold text-mystic-purple text-sm">1. Moral Justification ("The Noble Cause")</h4>
                            <p class="text-xs text-gray-600 mt-1">Reframing a harmful act as serving a higher, worthy purpose.</p>
                            <p class="text-xs text-indigo-800 mt-1 font-bold"><em>"I locked Rapunzel in the tower to protect her from the corruption of the world."</em></p>
                        </div>

                        <!-- Mechanism 2 -->
                        <div class="bg-white p-3 rounded border-l-4 border-royal-gold shadow-sm">
                            <h4 class="font-bold text-mystic-purple text-sm">2. Attribution of Blame ("They Started It")</h4>
                            <p class="text-xs text-gray-600 mt-1">Claiming the victim provoked the action, so they deserve it.</p>
                            <p class="text-xs text-indigo-800 mt-1 font-bold"><em>"If Goldilocks hadn't broken into MY house, I wouldn't have roared at her."</em></p>
                        </div>

                        <!-- Mechanism 3 -->
                        <div class="bg-white p-3 rounded border-l-4 border-royal-gold shadow-sm">
                            <h4 class="font-bold text-mystic-purple text-sm">3. Displacement of Responsibility ("No Choice")</h4>
                            <p class="text-xs text-gray-600 mt-1">Denying personal agency by blaming authority or social pressure.</p>
                            <p class="text-xs text-indigo-800 mt-1 font-bold"><em>"The Magic Mirror told me she was a threat to the kingdom. I had to act!"</em></p>
                        </div>
                    </div>

                    <!-- QUIZ TRIGGER BUTTON (New) -->
                    <div class="mt-6 bg-gradient-to-r from-mystic-purple to-indigo-900 rounded-lg shadow-lg p-1 overflow-hidden">
                        <div class="bg-mystic-purple/50 backdrop-blur-sm p-4 flex flex-col sm:flex-row items-center justify-between gap-4 text-white">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-royal-gold rounded-full flex items-center justify-center text-mystic-purple text-2xl animate-pulse">
                                    <i class="fas fa-gavel"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-royal-gold font-fantasy">Interactive Challenge</h4>
                                    <p class="text-xs text-gray-200">Test your skills: Can you spot the deception?</p>
                                </div>
                            </div>
                            <button onclick="openQuiz()" class="bg-royal-gold hover:bg-yellow-400 text-mystic-purple font-bold py-2 px-6 rounded-full shadow-lg transform transition hover:scale-105 uppercase text-sm tracking-wider">
                                Enter Courtroom
                            </button>
                        </div>
                    </div>

                    <!-- Video Link Section -->
                    <div class="mt-6 bg-white rounded-lg border-2 border-red-100 overflow-hidden shadow-sm group">
                        <a href="https://youtu.be/ATNsHTpCfaw" target="_blank" class="flex items-center gap-4 p-4 hover:bg-red-50 transition-colors cursor-pointer text-left">
                            <div class="flex-shrink-0 w-12 h-12 bg-red-600 text-white rounded-full flex items-center justify-center text-2xl shadow-md group-hover:scale-110 transition-transform">
                                <i class="fab fa-youtube"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-mystic-purple text-sm group-hover:text-red-700 transition-colors">Watch: The Wolf's Moral Justification</h4>
                                <p class="text-xs text-gray-600 mt-1">See how the "Big Bad Wolf" uses Attribution of Blame (she looked delicious!) to minimize his guilt.</p>
                            </div>
                            <div class="ml-auto text-gray-400">
                                <i class="fas fa-external-link-alt"></i>
                            </div>
                        </a>
                    </div>
                </section>

                <!-- Step by Step -->
                <section class="bg-white p-6 rounded-lg shadow-md border-l-4 border-mystic-purple">
                    <h3 class="font-bold text-xl text-mystic-purple mb-4">Your Writing Steps:</h3>
                    <ul class="space-y-4">
                        <li class="flex items-start gap-3">
                            <span class="bg-gray-200 text-mystic-purple font-bold w-6 h-6 rounded flex items-center justify-center flex-shrink-0 mt-1">1</span>
                            <span class="text-ink"><strong>Select a Character & Mechanism:</strong> Pick a villain and decide: Are they blaming the victim? Justifying it as protection?</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="bg-gray-200 text-mystic-purple font-bold w-6 h-6 rounded flex items-center justify-center flex-shrink-0 mt-1">2</span>
                            <span class="text-ink"><strong>Plan the Timeline:</strong> What happened before the main event? What was happening when the "hero" arrived?</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="bg-gray-200 text-mystic-purple font-bold w-6 h-6 rounded flex items-center justify-center flex-shrink-0 mt-1">3</span>
                            <span class="text-ink"><strong>Draft the Narrative:</strong> Write 150-200 words. Convince us your action was <strong>morally right</strong> (or unavoidable).</span>
                        </li>
                    </ul>
                </section>

                <!-- The Example -->
                <section class="relative mt-8">
                    <div class="absolute -top-4 -left-2 bg-royal-gold text-mystic-purple px-4 py-1 font-bold transform -rotate-2 shadow-md rounded-sm z-10">
                        Example: The Chief (Moral Justification)
                    </div>
                    <div class="bg-mystic-purple text-parchment p-8 rounded-lg shadow-inner italic font-narrative text-lg relative decorative-border">
                        <i class="fas fa-quote-left absolute top-4 left-4 text-royal-gold opacity-20 text-4xl"></i>
                        <p class="relative z-10 pl-6">
                            "I <span class="text-royal-gold font-bold not-italic border-b border-royal-gold cursor-help" title="Past Perfect">had locked</span> the sun in the box not out of greed, but to protect the earth from scorching heat. It was a noble sacrifice. One day, while my grandson <span class="text-cyan-300 font-bold not-italic border-b border-cyan-300 cursor-help" title="Past Continuous">was playing</span>, he began crying for it. I <span class="text-pink-300 font-bold not-italic border-b border-pink-300 cursor-help" title="Past Simple - Negative">didn't realize</span> he <span class="text-royal-gold font-bold not-italic border-b border-royal-gold cursor-help" title="Past Perfect">had tricked</span> me. I only wanted to make him happy, but he stole the light that I <span class="text-cyan-300 font-bold not-italic border-b border-cyan-300 cursor-help" title="Past Continuous">was guarding</span> for the safety of all!"
                        </p>
                    </div>
                </section>

            </div>

            <!-- Right Column: Grammar Toolkit (5 cols) -->
            <div class="lg:col-span-5 flex flex-col gap-6">
                
                <div class="bg-white p-6 rounded-xl shadow-lg border-2 border-royal-gold">
                    <div class="text-center mb-6">
                        <div class="inline-block p-3 rounded-full bg-parchment border border-royal-gold mb-2">
                            <i class="fas fa-tools text-2xl text-mystic-purple"></i>
                        </div>
                        <h2 class="text-2xl font-fantasy text-mystic-purple">Grammar in Action</h2>
                        <p class="text-sm text-gray-500">Narrative Tenses</p>
                    </div>

                    <!-- Grammar Card 1 -->
                    <div class="mb-5 group cursor-pointer">
                        <h3 class="text-pink-700 font-bold text-lg mb-1 flex items-center justify-between">
                            Past Simple
                            <i class="fas fa-check text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>
                        </h3>
                        <p class="text-xs uppercase tracking-wide text-gray-500 mb-2">The Main Events</p>
                        <div class="bg-pink-50 p-3 rounded border-l-4 border-pink-700 text-sm text-ink group-hover:bg-pink-100 transition-colors">
                            Use for the **main action**. These are the sequential events that drive the plot forward, telling the reader exactly what happened next.
                            <br><em class="text-gray-600 block mt-1">"He <strong>snatched</strong> the box, <strong>laughed</strong> wickedly, and <strong>ran</strong> into the night."</em>
                        </div>
                    </div>

                    <!-- Grammar Card 2 -->
                    <div class="mb-5 group cursor-pointer">
                        <h3 class="text-cyan-700 font-bold text-lg mb-1 flex items-center justify-between">
                            Past Continuous
                            <i class="fas fa-check text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>
                        </h3>
                        <p class="text-xs uppercase tracking-wide text-gray-500 mb-2">The Background / Setting the Scene</p>
                        <div class="bg-cyan-50 p-3 rounded border-l-4 border-cyan-700 text-sm text-ink group-hover:bg-cyan-100 transition-colors">
                            Use to <strong>set the scene</strong>. It describes the atmosphere (weather, sounds) and what was happening around the characters before the main action interrupted.
                            <br><em class="text-gray-600 block mt-1">"The wind <strong>was howling</strong> and I <strong>was cooking</strong> stew when..."</em>
                        </div>
                    </div>

                    <!-- Grammar Card 3 -->
                    <div class="group cursor-pointer">
                        <h3 class="text-amber-600 font-bold text-lg mb-1 flex items-center justify-between">
                            Past Perfect
                            <i class="fas fa-check text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>
                        </h3>
                        <p class="text-xs uppercase tracking-wide text-gray-500 mb-2">The Backstory</p>
                        <div class="bg-amber-50 p-3 rounded border-l-4 border-amber-600 text-sm text-ink group-hover:bg-amber-100 transition-colors">
                            Use for **flashbacks** and **reasons**. It explains what *had already happened* before the main story began, often revealing a character's motivation.
                            <br><em class="text-gray-600 block mt-1">"I was angry because he <strong>had promised</strong> never to touch the sacred fire."</em>
                        </div>
                    </div>

                </div>

                <!-- Connectors Box -->
                <div class="bg-white p-6 rounded-xl shadow-lg border-2 border-royal-gold relative">
                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-royal-gold text-mystic-purple px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm">
                        Flow & Clarity
                    </div>
                    
                    <div class="text-center mb-4 mt-2">
                        <h2 class="text-xl font-fantasy text-mystic-purple">Making Connections</h2>
                        <p class="text-xs text-gray-500">Guide the reader through your twist</p>
                    </div>

                    <div class="space-y-4">
                        <!-- Sequence -->
                        <div class="flex gap-3 items-start">
                            <div class="bg-indigo-100 text-indigo-800 p-2 rounded text-xs font-bold w-20 text-center shrink-0 mt-1">SEQUENCE</div>
                            <div class="text-sm text-ink">
                                <span class="font-bold text-gray-700">Once upon a time, Later, After that, Finally, Eventually</span>
                                <div class="mt-1 space-y-1">
                                    <p class="text-xs text-gray-500"><em>"<strong>Finally</strong>, the villagers understood my pain."</em></p>
                                    <p class="text-xs text-gray-500"><em>"<strong>Later</strong>, I tried to apologize to the pigs."</em></p>
                                </div>
                            </div>
                        </div>

                        <!-- Action/Surprise -->
                        <div class="flex gap-3 items-start">
                            <div class="bg-pink-100 text-pink-800 p-2 rounded text-xs font-bold w-20 text-center shrink-0 mt-1">ACTION</div>
                            <div class="text-sm text-ink">
                                <span class="font-bold text-gray-700">Suddenly, Unexpectedly, Meanwhile, In the beginning</span>
                                <div class="mt-1 space-y-1">
                                    <p class="text-xs text-gray-500"><em>"<strong>Unexpectedly</strong>, the 'hero' attacked me."</em></p>
                                    <p class="text-xs text-gray-500"><em>"<strong>Meanwhile</strong>, Goldilocks was eating my porridge!"</em></p>
                                </div>
                            </div>
                        </div>

                        <!-- Logic/Twist -->
                        <div class="flex gap-3 items-start">
                            <div class="bg-amber-100 text-amber-800 p-2 rounded text-xs font-bold w-20 text-center shrink-0 mt-1">LOGIC</div>
                            <div class="text-sm text-ink">
                                <span class="font-bold text-gray-700">Although, Because, So, As a result</span>
                                <div class="mt-1 space-y-1">
                                    <p class="text-xs text-gray-500"><em>"<strong>Although</strong> I looked scary, I was just lonely."</em></p>
                                    <p class="text-xs text-gray-500"><em>"I was starving, <strong>so</strong> I climbed the beanstalk."</em></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tip Box -->
                <div class="bg-mystic-dark text-parchment p-5 rounded-lg shadow-lg relative overflow-hidden">
                    <div class="relative z-10">
                        <h4 class="font-fantasy text-royal-gold text-lg mb-2"><i class="fas fa-lightbulb mr-2"></i>Storyteller's Tip</h4>
                        <p class="text-sm opacity-90">
                            To make the twist effective, justify the "villain's" actions. Maybe they were just trying to protect something (like the Chief) or they were simply hungry!
                        </p>
                    </div>
                </div>

            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-gray-100 p-4 text-center border-t border-gray-300">
            <p class="text-gray-500 text-sm font-body">Reference: Student Book p. 31 â€¢ Narrative Tenses Writing Task</p>
        </footer>

    </div>

    <!-- Print Control -->
    <div class="fixed bottom-4 right-4 print:hidden z-40">
        <button onclick="window.print()" class="bg-royal-gold hover:bg-yellow-600 text-mystic-purple font-bold py-3 px-6 rounded-full shadow-lg transition-all transform hover:scale-105 flex items-center gap-2 border-2 border-mystic-purple">
            <i class="fas fa-print"></i> Print Worksheet
        </button>
    </div>

    <!-- QUIZ MODAL (Hidden by default) -->
    <div id="quiz-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeQuiz()"></div>
        
        <!-- Modal Content -->
        <div class="relative bg-gradient-to-br from-gray-900 to-indigo-900 w-full max-w-4xl max-h-[90vh] overflow-y-auto rounded-2xl shadow-2xl border border-white/10 flex flex-col text-white">
            
            <!-- Close Button -->
            <button onclick="closeQuiz()" class="absolute top-4 right-4 text-white/50 hover:text-white z-10">
                <i class="fas fa-times text-2xl"></i>
            </button>

            <!-- Quiz Layout -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-0 min-h-[600px]">
                
                <!-- Left Panel (4 cols) -->
                <div class="lg:col-span-4 bg-black/20 p-6 lg:p-8 flex flex-col justify-center border-b lg:border-b-0 lg:border-r border-white/10">
                    <div class="mb-6">
                        <span class="text-royal-gold tracking-widest text-xs font-bold uppercase mb-2 block">TOK Psychology</span>
                        <h2 class="text-3xl font-fantasy text-white mb-2 leading-tight">Detect the <br><span class="text-royal-gold">Deception</span></h2>
                        <p class="text-gray-400 text-sm">Villains sleep well at night. Do you know why?</p>
                    </div>
                    
                    <div id="definition-box" class="bg-white/5 p-4 rounded-lg border-l-4 border-royal-gold mt-4">
                        <h3 class="text-royal-gold font-bold uppercase text-xs mb-1">Target Mechanism:</h3>
                        <h2 id="mechanism-title" class="text-xl font-fantasy text-white mb-2">Loading...</h2>
                        <p id="mechanism-def" class="text-gray-300 italic text-sm">Loading...</p>
                    </div>

                    <div class="mt-auto pt-6 flex items-center justify-between border-t border-white/10">
                        <div class="text-xs text-gray-500">Round <span id="current-round">1</span> / <span id="total-rounds">6</span></div>
                        <div class="text-lg font-bold text-royal-gold">Score: <span id="score">0</span></div>
                    </div>
                </div>

                <!-- Right Panel (8 cols) -->
                <div class="lg:col-span-8 p-6 lg:p-8 bg-white text-gray-800 relative flex flex-col">
                    
                    <!-- Result Screen (Hidden) -->
                    <div id="result-screen" class="hidden absolute inset-0 bg-mystic-dark z-20 flex flex-col items-center justify-center text-center p-8 text-white rounded-r-2xl">
                        <i class="fas fa-crown text-6xl text-royal-gold mb-6 animate-bounce"></i>
                        <h2 class="text-3xl font-fantasy mb-4">Judgment Delivered!</h2>
                        <p class="text-xl text-gray-300 mb-8">You scored <span id="final-score" class="text-royal-gold font-bold"></span> out of <span id="final-total"></span></p>
                        <div class="flex gap-4">
                            <button onclick="resetQuiz()" class="px-6 py-2 bg-royal-gold text-mystic-dark font-bold rounded-full hover:bg-yellow-500 transition-colors">Play Again</button>
                            <button onclick="closeQuiz()" class="px-6 py-2 border border-white/30 hover:bg-white/10 text-white font-bold rounded-full transition-colors">Close</button>
                        </div>
                    </div>

                    <!-- Scenario Header -->
                    <div class="mb-6 text-center">
                        <div class="inline-block bg-mystic-purple text-white px-3 py-1 rounded-full text-xs uppercase tracking-wider mb-2">
                            <i class="fas fa-map-marker-alt mr-2 text-royal-gold"></i> <span id="scenario-location">Location</span>
                        </div>
                        <h3 id="scenario-question" class="text-xl font-narrative italic text-mystic-dark">"Question..."</h3>
                    </div>

                    <!-- Character Cards -->
                    <div id="cards-container" class="grid grid-cols-1 gap-3 mb-6 flex-grow overflow-y-auto max-h-[400px]">
                        <!-- JS Injected -->
                    </div>

                    <!-- Feedback -->
                    <div id="feedback-area" class="hidden bg-gray-100 p-4 rounded-xl border border-gray-200 mt-auto">
                        <div class="flex items-start gap-3">
                            <div id="feedback-icon" class="w-8 h-8 rounded-full flex items-center justify-center text-white text-sm flex-shrink-0"></div>
                            <div>
                                <h4 id="feedback-title" class="font-bold text-sm mb-1">Title</h4>
                                <p id="feedback-text" class="text-xs text-gray-700">Explanation text.</p>
                            </div>
                        </div>
                        <div class="text-right mt-2">
                            <button id="next-btn" class="bg-mystic-purple text-white px-4 py-1 rounded hover:bg-mystic-dark transition-colors text-sm font-bold shadow-md">
                                Next Round <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        // Modal Logic
        const quizModal = document.getElementById('quiz-modal');
        function openQuiz() {
            quizModal.classList.remove('hidden');
            if(score === 0 && currentRoundIndex === 0) loadRound(0); // Only load if not started or reset
        }
        function closeQuiz() {
            quizModal.classList.add('hidden');
        }
        function resetQuiz() {
            currentRoundIndex = 0;
            score = 0;
            scoreEl.textContent = 0;
            document.getElementById('result-screen').classList.add('hidden');
            loadRound(0);
        }

        // Quiz Data (Expanded)
        const quizData = [
            {
                round: 1,
                mechanism: "Moral Justification",
                definition: "Reframing a bad action as serving a 'noble cause,' 'higher purpose,' or 'teaching a lesson.'",
                location: "The Interrogation Room",
                question: "Police Officer: \"Why did you steal the family's winter firewood?\"",
                characters: [
                    { id: 'A', name: "The Fox", role: "Character A", quote: "I didn't steal it! The farmer left the gate open. It's really his fault.", isCorrect: false, explanation: "Incorrect. Blaming the victim is <strong>Attribution of Blame</strong>." },
                    { id: 'B', name: "The Robin Hood", role: "Character B", quote: "I took the wood to keep the orphanage warm. Stealing is a small price to pay to save innocent lives.", isCorrect: true, explanation: "Correct! Claiming a 'greater good' to justify a bad act is <strong>Moral Justification</strong>." },
                    { id: 'C', name: "The Soldier", role: "Character C", quote: "My Captain ordered me to confiscate all wood. I have to follow orders.", isCorrect: false, explanation: "Incorrect. Following orders is <strong>Displacement of Responsibility</strong>." }
                ]
            },
            {
                round: 2,
                mechanism: "Attribution of Blame",
                definition: "Claiming the victim 'started it,' 'deserved it,' or 'provoked' the action.",
                location: "The Principal's Office",
                question: "Principal: \"Why did you push him into the mud?\"",
                characters: [
                    { id: 'A', name: "The Bully", role: "Character A", quote: "He was walking on MY side of the path. He knows the rules. He was asking for it.", isCorrect: true, explanation: "Correct! Saying the victim 'asked for it' is <strong>Attribution of Blame</strong>." },
                    { id: 'B', name: "The 'Hero'", role: "Character B", quote: "I pushed him to toughen him up. The world is a dirty place, he needs to learn resilience.", isCorrect: false, explanation: "Incorrect. Framing bullying as a lesson is <strong>Moral Justification</strong>." },
                    { id: 'C', name: "The Follower", role: "Character C", quote: "The other kids were chanting 'Push him!' The peer pressure was too strong.", isCorrect: false, explanation: "Incorrect. Blaming the group is <strong>Displacement of Responsibility</strong>." }
                ]
            },
            {
                round: 3,
                mechanism: "Displacement of Responsibility",
                definition: "Denying personal choice by blaming authority, social pressure, or 'having no choice.'",
                location: "The Magical Court",
                question: "Judge: \"Why did you cast the sleeping curse on the kingdom?\"",
                characters: [
                    { id: 'A', name: "The Sorcerer", role: "Character A", quote: "The King insulted my dignity! A royal insult demands a royal punishment.", isCorrect: false, explanation: "Incorrect. Framing revenge as honor is <strong>Moral Justification</strong>." },
                    { id: 'B', name: "The Minion", role: "Character B", quote: "The Dark Lord holds my soul in a jar. If I don't cast spells, he'll crush it. I'm just a tool.", isCorrect: true, explanation: "Correct! Claiming to be a tool with no free will is <strong>Displacement of Responsibility</strong>." },
                    { id: 'C', name: "The Trickster", role: "Character C", quote: "I didn't cast a 'curse,' I gave them a 'mandatory vacation.' They should thank me!", isCorrect: false, explanation: "Incorrect. Soft language is <strong>Euphemistic Labeling</strong>." }
                ]
            },
            {
                round: 4,
                mechanism: "Moral Justification",
                definition: "Reframing a bad action as serving a 'noble cause,' 'higher purpose,' or 'teaching a lesson.'",
                location: "The Rebel Base",
                question: "General: \"Why did you destroy the bridge, starving the village?\"",
                characters: [
                    { id: 'A', name: "The Strategist", role: "Character A", quote: "We sacrificed the bridge to save the entire country from tyranny. It was necessary for freedom.", isCorrect: true, explanation: "Correct! Destruction for 'freedom' is <strong>Moral Justification</strong>." },
                    { id: 'B', name: "The Soldier", role: "Character B", quote: "The Commander gave the signal. I just pushed the button.", isCorrect: false, explanation: "Incorrect. Blaming the commander is <strong>Displacement of Responsibility</strong>." },
                    { id: 'C', name: "The Engineer", role: "Character C", quote: "The villagers built it too weak. It's their fault it collapsed so easily.", isCorrect: false, explanation: "Incorrect. Blaming the builders is <strong>Attribution of Blame</strong>." }
                ]
            },
            {
                round: 5,
                mechanism: "Attribution of Blame",
                definition: "Claiming the victim 'started it,' 'deserved it,' or 'provoked' the action.",
                location: "The Dragon's Lair",
                question: "Knight: \"Why did you burn down the farm?\"",
                characters: [
                    { id: 'A', name: "The Minion", role: "Character A", quote: "The Dark Wizard controls my mind. I physically cannot disobey.", isCorrect: false, explanation: "Incorrect. Lack of control is <strong>Displacement of Responsibility</strong>." },
                    { id: 'B', name: "The Cultist", role: "Character B", quote: "Fire is a purifying force. We are cleansing the land for a new world.", isCorrect: false, explanation: "Incorrect. 'Cleansing' is <strong>Moral Justification</strong>." },
                    { id: 'C', name: "The Dragon", role: "Character C", quote: "They poked the sleeping dragon! If they hadn't been so greedy, I would have stayed asleep.", isCorrect: true, explanation: "Correct! 'They poked me' is <strong>Attribution of Blame</strong>." }
                ]
            },
            {
                round: 6,
                mechanism: "Displacement of Responsibility",
                definition: "Denying personal choice by blaming authority, social pressure, or 'having no choice.'",
                location: "The Corporate Boardroom",
                question: "Reporter: \"Why did you dump the toxic waste in the river?\"",
                characters: [
                    { id: 'A', name: "The CEO", role: "Character A", quote: "It's not 'toxic waste,' it's 'industrial byproduct' that helps algae grow.", isCorrect: false, explanation: "Incorrect. This is <strong>Euphemistic Labeling</strong>." },
                    { id: 'B', name: "The Manager", role: "Character B", quote: "The fish were swimming too close to the pipes. They shouldn't be near our property.", isCorrect: false, explanation: "Incorrect. Blaming the fish is <strong>Attribution of Blame</strong>." },
                    { id: 'C', name: "The Employee", role: "Character C", quote: "I was just following company policy. I'm just a cog in the machine.", isCorrect: true, explanation: "Correct! 'Cog in the machine' is <strong>Displacement of Responsibility</strong>." }
                ]
            }
        ];

        let currentRoundIndex = 0;
        let score = 0;
        let canClick = true;

        // DOM Elements
        const mechanismTitle = document.getElementById('mechanism-title');
        const mechanismDef = document.getElementById('mechanism-def');
        const currentRoundEl = document.getElementById('current-round');
        const totalRoundsEl = document.getElementById('total-rounds');
        const scoreEl = document.getElementById('score');
        const scenarioLocation = document.getElementById('scenario-location');
        const scenarioQuestion = document.getElementById('scenario-question');
        const cardsContainer = document.getElementById('cards-container');
        const feedbackArea = document.getElementById('feedback-area');
        const feedbackIcon = document.getElementById('feedback-icon');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackText = document.getElementById('feedback-text');
        const nextBtn = document.getElementById('next-btn');

        // Init
        totalRoundsEl.textContent = quizData.length;
        
        function loadRound(index) {
            const data = quizData[index];
            
            mechanismTitle.textContent = data.mechanism;
            mechanismDef.textContent = data.definition;
            currentRoundEl.textContent = index + 1;
            scenarioLocation.textContent = data.location;
            scenarioQuestion.textContent = data.question;

            feedbackArea.classList.add('hidden');
            cardsContainer.innerHTML = '';
            canClick = true;

            data.characters.forEach(char => {
                const card = document.createElement('div');
                card.className = `bg-white border-2 border-gray-100 rounded-xl p-4 cursor-pointer hover:border-royal-gold flex flex-col transition-all`;
                card.onclick = () => handleAnswer(char, card);

                card.innerHTML = `
                    <div class="flex items-center gap-3 mb-2 border-b border-gray-100 pb-2">
                        <div class="w-6 h-6 rounded-full bg-mystic-purple text-white flex items-center justify-center font-bold text-xs">${char.id}</div>
                        <div>
                            <h4 class="font-bold text-mystic-dark text-sm leading-none">${char.role}</h4>
                            <span class="text-xs text-gray-500 uppercase tracking-wider">${char.name}</span>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 font-narrative italic">"${char.quote}"</p>
                `;
                cardsContainer.appendChild(card);
            });
        }

        function handleAnswer(character, cardElement) {
            if (!canClick) return;
            canClick = false;

            if (character.isCorrect) {
                cardElement.classList.add('selected-correct');
                score++;
                scoreEl.textContent = score;
                showFeedback(true, character.explanation);
            } else {
                cardElement.classList.add('selected-wrong');
                showFeedback(false, character.explanation);
            }
        }

        function showFeedback(isCorrect, text) {
            feedbackArea.classList.remove('hidden');
            feedbackText.innerHTML = text;

            if (isCorrect) {
                feedbackIcon.className = "w-8 h-8 rounded-full flex items-center justify-center text-white text-sm flex-shrink-0 bg-green-500";
                feedbackIcon.innerHTML = '<i class="fas fa-check"></i>';
                feedbackTitle.textContent = "Correct!";
                feedbackTitle.className = "font-bold text-sm mb-1 text-green-700";
            } else {
                feedbackIcon.className = "w-8 h-8 rounded-full flex items-center justify-center text-white text-sm flex-shrink-0 bg-red-500";
                feedbackIcon.innerHTML = '<i class="fas fa-times"></i>';
                feedbackTitle.textContent = "Not quite...";
                feedbackTitle.className = "font-bold text-sm mb-1 text-red-700";
            }
        }

        nextBtn.onclick = () => {
            currentRoundIndex++;
            if (currentRoundIndex < quizData.length) {
                loadRound(currentRoundIndex);
            } else {
                showResults();
            }
        };

        function showResults() {
            document.getElementById('final-score').textContent = score;
            document.getElementById('final-total').textContent = quizData.length;
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('result-screen').classList.add('flex');
        }
    </script>
</body>
</html>
